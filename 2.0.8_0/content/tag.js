!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).browserId3Writer=e()}(function(){return function e(t,n,s){function o(i,r){if(!n[i]){if(!t[i]){var c,l,d="function"==typeof require&&require;if(!r&&d)return d(i,!0);if(a)return a(i,!0);throw l=new Error("Cannot find module '"+i+"'"),l.code="MODULE_NOT_FOUND",l}c=n[i]={exports:{}},t[i][0].call(c.exports,function(e){return o(t[i][1][e]||e)},c,c.exports,e,t,n,s)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<s.length;i++)o(s[i]);return o}({1:[function(e,t,n){var s=this,o=function(){"use strict";function n(e){return String(e).split("").map(function(e){return e.charCodeAt(0)})}function e(e){return new Uint8Array(n(e))}function t(e){var t=new Uint8Array(2*e.length);return new Uint16Array(t.buffer).set(n(e)),t}return function(){var n=s.prototype;function s(e){if(!(e&&"object"==typeof e&&"byteLength"in e))throw new Error("First argument should be an instance of ArrayBuffer or Buffer");this.arrayBuffer=e,this.padding=4096,this.frames=[],this.url=""}return n._setIntegerFrame=function(e,t){var n=parseInt(t,10);this.frames.push({name:e,value:n,size:11+n.toString().length})},n._setStringFrame=function(e,t){var n=t.toString();this.frames.push({name:e,value:n,size:13+2*n.length})},n._setPictureFrame=function(e,t,n,s){var o,a,r,i=function(e){if(!e||!e.length)return null;if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(87===e[8]&&69===e[9]&&66===e[10]&&80===e[11])return"image/webp";var t=73===e[0]&&73===e[1]&&42===e[2]&&0===e[3],n=77===e[0]&&77===e[1]&&0===e[2]&&42===e[3];return t||n?"image/tiff":66===e[0]&&77===e[1]?"image/bmp":0===e[0]&&0===e[1]&&1===e[2]&&0===e[3]?"image/x-icon":null}(new Uint8Array(t)),c=n.toString();if(!i)throw new Error("Unknown picture MIME type");n||(s=!1),this.frames.push({name:"APIC",value:t,pictureType:e,mimeType:i,useUnicodeEncoding:s,description:c,size:(a=t.byteLength,r=i.length,o=c.length,11+r+1+1+(s?2+2*(o+1):o+1)+a)})},n._setLyricsFrame=function(e,t,n){var s,o,r=e.split("").map(function(e){return e.charCodeAt(0)}),i=t.toString(),a=n.toString();this.frames.push({name:"USLT",value:a,language:r,description:i,size:(s=i.length,o=a.length,16+2*s+2+2+2*o)})},n._setCommentFrame=function(e,t,n){var s,o,r=e.split("").map(function(e){return e.charCodeAt(0)}),i=t.toString(),a=n.toString();this.frames.push({name:"COMM",value:a,language:r,description:i,size:(s=i.length,o=a.length,16+2*s+2+2+2*o)})},n._setPrivateFrame=function(e,t){var n,s,o=e.toString();this.frames.push({name:"PRIV",value:t,id:o,size:(n=o.length,s=t.byteLength,10+n+1+s)})},n._setUserStringFrame=function(e,t){var n,s,o=e.toString(),i=t.toString();this.frames.push({name:"TXXX",description:o,value:i,size:(n=o.length,s=i.length,13+2*n+2+2+2*s)})},n._setUrlLinkFrame=function(e,t){var n=t.toString();this.frames.push({name:e,value:n,size:10+n.length})},n.setFrame=function(e,t){switch(e){case"TPE1":case"TCOM":case"TCON":if(!Array.isArray(t))throw new Error(e+" frame value should be an array of strings");var n="TCON"===e?";":"/",s=t.join(n);this._setStringFrame(e,s);break;case"TLAN":case"TIT1":case"TIT2":case"TIT3":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TMED":case"TPUB":case"TCOP":case"TKEY":case"TEXT":case"TSRC":this._setStringFrame(e,t);break;case"TBPM":case"TLEN":case"TDAT":case"TYER":this._setIntegerFrame(e,t);break;case"USLT":if(t.language=t.language||"eng",!("object"==typeof t&&"description"in t&&"lyrics"in t))throw new Error("USLT frame value should be an object with keys description and lyrics");if(t.language&&!t.language.match(/[a-z]{3}/i))throw new Error("Language must be coded following the ISO 639-2 standards");this._setLyricsFrame(t.language,t.description,t.lyrics);break;case"APIC":if(!("object"==typeof t&&"type"in t&&"data"in t&&"description"in t))throw new Error("APIC frame value should be an object with keys type, data and description");if(t.type<0||20<t.type)throw new Error("Incorrect APIC frame picture type");this._setPictureFrame(t.type,t.data,t.description,!!t.useUnicodeEncoding);break;case"TXXX":if(!("object"==typeof t&&"description"in t&&"value"in t))throw new Error("TXXX frame value should be an object with keys description and value");this._setUserStringFrame(t.description,t.value);break;case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":this._setUrlLinkFrame(e,t);break;case"COMM":if(t.language=t.language||"eng",!("object"==typeof t&&"description"in t&&"text"in t))throw new Error("COMM frame value should be an object with keys description and text");if(t.language&&!t.language.match(/[a-z]{3}/i))throw new Error("Language must be coded following the ISO 639-2 standards");this._setCommentFrame(t.language,t.description,t.text);break;case"PRIV":if(!("object"==typeof t&&"id"in t&&"data"in t))throw new Error("PRIV frame value should be an object with keys id and data");this._setPrivateFrame(t.id,t.data);break;default:throw new Error("Unsupported frame "+e)}return this},n.removeTag=function(){if(!(this.arrayBuffer.byteLength<10)){var t,n,e=new Uint8Array(this.arrayBuffer),s=e[3],o=((t=[e[6],e[7],e[8],e[9]])[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+10;73!==(n=e)[0]||68!==n[1]||51!==n[2]||s<2||4<s||(this.arrayBuffer=new Uint8Array(e.subarray(o)).buffer)}},n.addTag=function(){this.removeTag();var i,a=[255,254],r=10+this.frames.reduce(function(e,t){return e+t.size},0)+this.padding,c=new ArrayBuffer(this.arrayBuffer.byteLength+r),o=new Uint8Array(c),s=0,n=[];return n=[73,68,51,3],o.set(n,s),s+=n.length,s++,s++,n=[(i=r-10)>>>21&127,i>>>14&127,i>>>7&127,127&i],o.set(n,s),s+=n.length,this.frames.forEach(function(i){var r;switch(n=e(i.name),o.set(n,s),s+=n.length,r=i.size-10,n=[r>>>24&255,r>>>16&255,r>>>8&255,255&r],o.set(n,s),s+=n.length,s+=2,i.name){case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":n=e(i.value),o.set(n,s),s+=n.length;break;case"TPE1":case"TCOM":case"TCON":case"TLAN":case"TIT1":case"TIT2":case"TIT3":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TKEY":case"TMED":case"TPUB":case"TCOP":case"TEXT":case"TSRC":n=[1].concat(a),o.set(n,s),s+=n.length,n=t(i.value),o.set(n,s),s+=n.length;break;case"TXXX":case"USLT":case"COMM":n=[1],"USLT"!==i.name&&"COMM"!==i.name||(n=n.concat(i.language)),n=n.concat(a),o.set(n,s),s+=n.length,n=t(i.description),o.set(n,s),s+=n.length,n=[0,0].concat(a),o.set(n,s),s+=n.length,n=t(i.value),o.set(n,s),s+=n.length;break;case"TBPM":case"TLEN":case"TDAT":case"TYER":s++,n=e(i.value),o.set(n,s),s+=n.length;break;case"PRIV":n=e(i.id),o.set(n,s),s+=n.length,s++,o.set(new Uint8Array(i.value),s),s+=i.value.byteLength;break;case"APIC":n=[i.useUnicodeEncoding?1:0],o.set(n,s),s+=n.length,n=e(i.mimeType),o.set(n,s),s+=n.length,n=[0,i.pictureType],o.set(n,s),s+=n.length,i.useUnicodeEncoding?(n=[].concat(a),o.set(n,s),s+=n.length,n=t(i.description),o.set(n,s),s+=n.length,s+=2):(n=e(i.description),o.set(n,s),s+=n.length,s++),o.set(new Uint8Array(i.value),s),s+=i.value.byteLength}}),s+=this.padding,o.set(new Uint8Array(this.arrayBuffer),s),this.arrayBuffer=c},n.getBlob=function(){return new Blob([this.arrayBuffer],{type:"audio/mpeg"})},n.getURL=function(){return this.url||(this.url=URL.createObjectURL(this.getBlob())),this.url},n.revokeURL=function(){URL.revokeObjectURL(this.url)},s}()};"object"==typeof n&&void 0!==t?t.exports=o():(s=s||self).ID3Writer=o()},{}]},{},[1])(1)})